{% extends "base.html" %}

{% block title %}
    Meu Perfil
{% endblock %}

{% block content %}

<div class="container-interno">

    <div class="profile-intro">
        <h2 style="margin-bottom: 5px;">
            Olá, {{ current_user.nome.split()[0] }}!
        </h2>
        <p style="color: var(--secondary); margin-bottom: 30px;">
            Bem-vindo(a) ao seu painel.
            <br><a href="{{ url_for('atualizar_dados') }}" class="perfil-action-link">Atualizar meus dados</a><br>
        </p>

        <hr>

        <h3>Meu Histórico de Reservas</h3>
    </div>

    <div class="reservas-lista">
        {% for reserva in reservas %}
        <div class="reserva-card">
            <div class="reserva-img">
                {% if reserva.veiculo_alugado.foto_url %}
                    <img src="{{ url_for('static', filename='img/' + reserva.veiculo_alugado.foto_url) }}" 
                         alt="{{ reserva.veiculo_alugado.nome }}" class="img-tooltip" 
                         data-desc="Imagem do veículo {{ reserva.veiculo_alugado.nome }}">
                {% else %}
                    <span>Sem Foto</span>
                {% endif %}
            </div>

            <div class="reserva-info">
                <h4>{{ reserva.veiculo_alugado.nome }} - <small style="font-size: 20px;">Reserva #{{ reserva.id }}</small></h4>
                <p>
                    <strong>Status:</strong> 
                    {% if reserva.status == 'Confirmada' %}
                        <span class="status-confirmada">{{ reserva.status }}</span>
                    {% else %}
                        <span class="status-cancelada">{{ reserva.status }}</span>
                    {% endif %}
                </p>
                <p>
                    <strong>Período:</strong> 
                    {{ reserva.data_inicio.strftime('%d/%m/%Y') }}
                    até
                    {{ reserva.data_fim.strftime('%d/%m/%Y') }}
                </p>
                <p>
                    <strong>Total:</strong> 
                    <span class="preco-reserva">R$ {{ "%.2f"|format(reserva.preco_total) }}</span>
                </p>
            </div>

            <div class="reserva-acao">
                {% if reserva.status == 'Confirmada' %}
                    <form action="{{ url_for('cancelar_reserva', reserva_id=reserva.id) }}" method="POST">
                        <button type="submit" class="btn-cancelar" onclick="return confirm('Tem certeza que quer cancelar esta reserva?')">
                            Cancelar
                        </button>
                    </form>
                {% endif %}
            </div>
        </div>
        {% else %}
            <p>Você ainda não fez nenhuma reserva.</p>
        {% endfor %}
    </div>
</div>

{% endblock %}
