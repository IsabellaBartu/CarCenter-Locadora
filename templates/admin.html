{% extends "base.html" %}

{% block title %}
    Painel de Admin
{% endblock %}

{% block content %}
    <h2>Painel de Administração</h2>
    <p>Gerenciamento de frota, feedbacks e usuários.</p>
    
    <hr>
    <h3>Gerenciar Frota</h3>
    
    <h4>Adicionar Novo Veículo</h4>
    <form class="form-admin-grid" action="{{ url_for('pagina_admin') }}" method="POST">
        
        <div class="form-grupo-admin">
            <label for="nome_veiculo">Nome do Veículo:</label>
            <input type="text" id="nome_veiculo" name="nome_veiculo" 
                   placeholder="Ex: Fiat Fastback" required>
        </div>
        <div class="form-grupo-admin">
            <label for="modelo_veiculo">Modelo/Categoria:</label>
            <input type="text" id="modelo_veiculo" name="modelo_veiculo"
                   placeholder="Ex: SUV, Econômico, Luxo">
        </div>
        <div class="form-grupo-admin">
            <label for="ano_veiculo">Ano do Modelo:</label>
            <input type="number" id="ano_veiculo" name="ano_veiculo"
                   placeholder="Ex: 2024">
        </div>
        
        <div class="form-grupo-admin">
            <label for="preco_veiculo">Preço da Diária (R$):</label>
            <input type="text" id="preco_veiculo" name="preco_veiculo"
                   placeholder="Ex: 99.05 (use ponto, não vírgula)" required>
        </div>
        <div class="form-grupo-admin">
            <label for="foto_veiculo">Nome do Arquivo da Foto:</label>
            <input type="text" id="foto_veiculo" name="foto_veiculo" 
                   placeholder="Ex: fiatfastback.png (nome exato!)"
                   title="O nome do arquivo DEVE ser exato ao arquivo em /static/img/">
        </div>
        
        <div class="form-grupo-admin">
            <label for="placa_veiculo">Placa:</label>
            <input type="text" id="placa_veiculo" name="placa_veiculo"
                   placeholder="Ex: ABC1D23">
        </div>
        <div class="form-grupo-admin">
            <label for="cor_veiculo">Cor:</label>
            <input type="text" id="cor_veiculo" name="cor_veiculo"
                   placeholder="Ex: Preto">
        </div>
        
        <div class="form-grupo-admin-full">
            <label for="desc_veiculo">Descrição Curta (para o card):</label>
            <textarea id="desc_veiculo" name="desc_veiculo" rows="3"
                      placeholder="Ex: Modelo 2026. Confortável, automático e completo."></textarea>
        </div>
        <div class="form-grupo-admin-full">
            <button type="submit" class="btn-confirmar">Adicionar Veículo à Frota</button>
        </div>
    </form>
    
    <h4 style="margin-top: 20px;">Frota Cadastrada</h4>
    <table class="tabela-admin">
        <thead>
            <tr>
                <th>ID</th>
                <th>Foto</th>
                <th>Nome</th>
                <th>Placa</th> <th>Cor</th> 
                <th>Status</th>
                <th>Preço/Dia</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
    {% for carro in veiculos %}
    <tr>
        <td>{{ carro.id }}</td>
        <td>
            {% if carro.foto_url %}
                <img src="{{ url_for('static', filename='img/' + carro.foto_url) }}" alt="{{ carro.nome }}" width="100">
            {% else %}
                <span>Sem Foto</span>
            {% endif %}
        </td>
        <td>{{ carro.nome }}</td>
        <td>{{ carro.placa or '-' }}</td>
        <td>{{ carro.cor or '-' }}</td>
        
        <td>
            {% if carro.is_available %}
                <span class="status-disponivel">DISPONÍVEL</span>
            {% else %}
                <span class="status-reservado">RESERVADO</span>
            {% endif %}
        </td>

        <td>R$ {{ "%.2f"|format(carro.preco_diaria) }}</td>
        
        <td>
            <form action="{{ url_for('toggle_veiculo_status', carro_id=carro.id) }}" method="POST">
                {% if carro.is_available %}
                    <button type="submit" class="btn-toggle-reservar">Reservar</button>
                {% else %}
                    <button type="submit" class="btn-toggle-devolver">Devolvido</button>
                {% endif %}
            </form>
        </td>
    </tr>
    {% else %}
    <tr>
        <td colspan="7">Nenhum veículo cadastrado ainda.</td>
    </tr>
    {% endfor %}
</tbody>
    </table>


    <hr>
    <h3>Usuários Cadastrados</h3>
    <table class="tabela-admin">
        <thead>
            <tr>
                <th>ID</th>
                <th>Username</th>
                <th>Cargo (Role)</th>
            </tr>
        </thead>
        <tbody>
            {% for usuario in usuarios %}
            <tr>
                <td>{{ usuario.id }}</td>
                <td>{{ usuario.username }}</td>
                <td>
                    {% if usuario.role == 'admin' %}
                        <strong>{{ usuario.role.upper() }}</strong>
                    {% else %}
                        {{ usuario.role }}
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="3">Nenhum usuário cadastrado.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <hr>
    <h3>Feedbacks Recebidos</h3>
    <div class="feedback-lista">
        {% for item in feedbacks %}
            <div class="feedback-item">
                <h4>Avaliação: {{ item.rating }} / 5 Estrelas</h4>
                {% if item.nome != 'Anônimo' %}
                    <p><strong>De:</strong> {{ item.nome }}</p>
                {% endif %}
                <p class="comentario">"{{ item.comentario }}"</p>
            </div>
        {% else %}
            <p>Nenhum feedback recebido ainda.</p>
        {% endfor %}
    </div>
    
{% endblock %}