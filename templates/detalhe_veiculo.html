{% extends "base.html" %}

{% block title %}
    Detalhes: {{ carro.nome }}
{% endblock %}

{% block content %}
    
    <div class="detalhe-container">
        <div class="detalhe-imagem">
            {% if carro.foto_url %}
                <img src="{{ url_for('static', filename='img/' + carro.foto_url) }}" alt="{{ carro.nome }}">
            {% else %}
                <div class="carro-placeholder-img"></div>
            {% endif %}
        </div>
        
        <div class="detalhe-info" id="area-calculo" data-preco-diaria="{{ carro.preco_diaria }}">
            
            <h2>{{ carro.nome }}</h2>
            <span class="preco-detalhe">R$ {{ "%.2f"|format(carro.preco_diaria) }} /dia</span>
            
            <p class="descricao-detalhe">{{ carro.descricao }}</p>
            
            <ul class="specs-lista">
                <li><strong>Modelo:</strong> {{ carro.modelo or 'Não informado' }}</li>
                <li><strong>Ano:</strong> {{ carro.ano or 'Não informado' }}</li>
                <li><strong>Cor:</strong> {{ carro.cor or 'Não informada' }}</li>
            </ul>
            
            <hr>

            <form action="{{ url_for('iniciar_reserva') }}" method="POST">
                
                <input type="hidden" name="carro_id" value="{{ carro.id }}">

                <h4>Selecione o Período:</h4>
                <div class="form-linha" style="gap: 20px; display: flex;">
                    <div class="form-grupo" style="flex: 1;">
                        <label for="data_inicio">Data de Retirada:</label>
                        <input type="date" id="data_inicio" name="data_inicio" class="input-calculo" required>
                    </div>
                    <div class="form-grupo" style="flex: 1;">
                        <label for="data_fim">Data de Devolução:</label>
                        <input type="date" id="data_fim" name="data_fim" class="input-calculo" required>
                    </div>
                </div>
                
             <button type="submit" class="btn-confirmar btn-detalhe">
                    Reservar e Ir para Pagamento
                </button>
                
            </form>
        </div>
    </div>
    
{% endblock %}
<script>
    const precoDiaria = parseFloat(document.getElementById('area-calculo').dataset.precoDiaria);
    const inputInicio = document.getElementById("data_inicio");
    const inputFim = document.getElementById("data_fim");
    const campoTotal = document.getElementById("preco-total");

    function atualizarTotal() {
        const inicio = new Date(inputInicio.value);
        const fim = new Date(inputFim.value);

        if (inputInicio.value && inputFim.value && fim > inicio) {
            const diffDias = Math.ceil((fim - inicio) / (1000 * 60 * 60 * 24));
            const total = diffDias * precoDiaria;
            campoTotal.textContent = "R$ " + total.toFixed(2).replace(".", ",");
        } else {
            campoTotal.textContent = "R$ 0,00";
        }
    }

    inputInicio.addEventListener("change", atualizarTotal);
    inputFim.addEventListener("change", atualizarTotal);
</script>
